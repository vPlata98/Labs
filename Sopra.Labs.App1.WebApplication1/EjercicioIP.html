<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="vendor/bootstrap-5.1.3-dist/css/bootstrap.css" rel="stylesheet" />
</head>
<body>
    <br />
    <div class="container">
        <div class="row">
            <div class="col">
                <h1>Demo Javascript</h1>
                <hr />
            </div>
        </div>
        <div class="row">
            <div class="col">
                <form>
                    <div class="mb-3">
                        <label for="ip" class="form-label">Nombre</label>
                        <input type="text" class="form-control" name="ip" id="ip" placeholder="escribe la ip" />
                    </div>
                    <input id="b1" type="button" class="btn btn-warning" value="Consultar" onclick="OnClick(this)" />
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <span>Ciudad: </span>
                <br />
                <span>Pais: </span>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function OnClick(e) {
            var ip = document.getElementById("ip").value;
            if (ip == undefined || ip == null || ip == "") {
                return;
            }
            var xhr = new XMLHttpRequest();

            xhr.open("GET", "http://ip-api.com/json/193.146.141.207");
            xhr.onreadystatechange = (e) => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var obj = JSON.parse(xhr.responseText);
                    var sp = document.getElementsByTagName("span");
                    sp[0].textContent += obj.country;
                    sp[1].textContent += obj.regionName;
                    console.log(obj);
                }
            }
            xhr.send();
        
            // AJAX Asynchronous Javascript and XML
            // Creamos instancia del cliente
            //var xhr = new XMLHttpRequest();
            //// El usuario siente que el navegador se ha quedado parado
            //// xhr.open("GET", "", false, "Usuario", "Contraseña");
            //// Configuramos el cliente
            //xhr.open("GET", "http://ip-api.com/json/193.146.141.207", true);
            //// Antes de hacer send, nos suscribimos al evento onReadyStateChange
            //xhr.onreadystatechange = () => {

            //}

            //xhr.onreadystatechange = function () {
            //    if (xhr.readyState == 4 && xhr.status == 200) {
            //        console.log("Status: " + xhr.status + " State: " + xhr.readyState);
            //        console.log("Respuesta: " + xhr.responseText );
            //        // Accedemos a la respuesta
            //        /*
            //            READYSTATE_UNINITIALIZED 0
            //            Default initialization state.
            //            READYSTATE_LOADING 1
            //            Object is currently loading its properties.
            //            READYSTATE_LOADED 2
            //            Object has been initialized.
            //            READYSTATE_INTERACTIVE 3
            //            Object is interactive, but not all of its data is available.
            //            READYSTATE_COMPLETE 4
            //            Object has received all of its data.

            //         */
            //        var obj = JSON.parse(xhr.responseText);
            //        var sp = document.getElementsByTagName("span");
            //        sp[0].textContent += obj.country;
            //        sp[1].textContent += obj.regionName;
            //        console.log(obj);
            //    }
        }
            //Iniciamos la comunicacion
            
        




        // DOM Document Object Model
        function click() {
            function OnClick(e) {
                e.value = "Clickeado";
                console.log("click");
                window.alert("Click");
            }
            function selector() {
                var boton1 = document.getElementById("b1"); //cogemos el boton uno
                boton1.value = "Grabar"
                console.log(boton1.value);
            }
            var global = "hola mundo";
            function saludo(texto) {
                var global = "adios";
                document.write("<br/> <h1>" + global + "<h1/>");
            }
            var app ={
                Core: { },
                Data: {
                    Codigos: [],
                    Mensaje: "Hola mundo",
                    token: {
                        key1: "ewfdwddw",
                        key2: "dwedwedwedwed",
                        validator: function (){

                        }
                    }
                },
                Dashboard: { },
                Security: { }
            };
            saludo(global);

        }

    </script>
</body>
</html>